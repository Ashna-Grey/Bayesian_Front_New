<!DOCTYPE html>
<html>
<head>
<title>Adaptive Authentication</title>
</head>
<body>
<h2>Register</h2>
<input id="reg_email" placeholder="Email"><br><br>
<input id="reg_username" placeholder="Username"><br><br>
<input id="reg_password" type="password" placeholder="Password"><br><br>
<button onclick="register()">Register</button>
<hr>
<h2>Login</h2>
<input id="email" placeholder="Email"><br><br>
<input id="password" type="password" placeholder="Password"><br><br>
<button onclick="login()">Login</button>
<div id="otpBox" style="display:none;">
    <h3>Enter OTP</h3>
    <input id="otp" placeholder="OTP">
    <button onclick="verifyOTP()">Verify OTP</button>
</div>
<p id="result"></p>
<script>
const API ="https://bayesian-new.onrender.com";
let mouseData = [];
document.addEventListener("mousemove", e => {
    mouseData.push({
        x:e.clientX,
        y:e.clientY,
        t:Date.now()
    });
    if(mouseData.length>200)
        mouseData.shift();
});
async function register(){
const response = await fetch(
`${API}/register`,
{
method:"POST",
headers:{
"Content-Type":"application/json"
},
body:JSON.stringify({
email:document.getElementById("reg_email").value,
username:document.getElementById("reg_username").value,
password:document.getElementById("reg_password").value
})
});
const data = await response.json();
document.getElementById("result")
.innerText = data.message;
}
async function login(){
if(!navigator.geolocation){
alert("Location not supported");
return;
}
navigator.geolocation.getCurrentPosition(
async position => {
const response = await fetch(
`${API}/login`,
{
method:"POST",
headers:{
"Content-Type":"application/json"
},
body:JSON.stringify({
email:document.getElementById("email").value,
password:document.getElementById("password").value,
latitude:position.coords.latitude,
longitude:position.coords.longitude,
mouse:mouseData
})
});
const data = await response.json();
if(data.decision==="ENTER_OTP"){
document.getElementById("otpBox")
.style.display="block";
document.getElementById("result")
.innerText="OTP sent to email";
}
});
}
async function verifyOTP(){
const response = await fetch(
`${API}/verify-otp`,
{
method:"POST",
headers:{
"Content-Type":"application/json"
},
body:JSON.stringify({
email:document.getElementById("email").value,
otp:document.getElementById("otp").value
})
});
const data = await response.json();
if(data.confidence!==undefined){
document.getElementById("result")
.innerText =
"âœ… Login Successful\nConfidence: "
+ Number(data.confidence).toFixed(3);
}
else{
document.getElementById("result")
.innerText="OTP Failed";
}
}
</script>
</body>
</html>
